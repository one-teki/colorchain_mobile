/* Basic reset */
* {
    box-sizing: border-box;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
}

body {
    margin: 0;
    font-family: "Helvetica Neue", Arial, sans-serif;
    background: #f5f5f5;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;

    /* Add safe area padding on devices with notches (iOS) */
    /* constant() is deprecated but kept for backwards compatibility */
    padding-top: constant(safe-area-inset-top);
    padding-top: env(safe-area-inset-top);
    padding-bottom: constant(safe-area-inset-bottom);
    padding-bottom: env(safe-area-inset-bottom);
    padding-left: constant(safe-area-inset-left);
    padding-left: env(safe-area-inset-left);
    padding-right: constant(safe-area-inset-right);
    padding-right: env(safe-area-inset-right);
}

#app {
    text-align: center;
    max-width: 420px;
    width: 100%;
}

h1 {
    margin-bottom: 10px;
    font-size: 28px;
    color: #333;
}

#info {
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 12px;
    /* Use responsive font sizes that adapt to screen width.  On small
       devices, this will reduce clutter and improve readability. */
    font-size: clamp(14px, 3vw, 16px);
}

.info-item {
    flex: 1 1 45%;
    text-align: center;
    font-weight: bold;
    /* Allow text to wrap on smaller screens */
    word-break: break-word;
}

/* Stack info items vertically on very narrow screens for better readability */
@media (max-width: 480px) {
    #info {
        flex-direction: column;
        align-items: stretch;
    }
    .info-item {
        flex: none;
        width: 100%;
    }
}

/* Time bar styling */
#timeBarContainer {
    position: relative;
    width: 100%;
    height: 12px;
    background: #dfe6e9;
    border-radius: 6px;
    overflow: hidden;
    margin-bottom: 12px;
}

#timeBar {
    position: absolute;
    left: 0;
    top: 0;
    height: 100%;
    width: 100%;
    background: linear-gradient(90deg, #6dd5fa, #2980b9);
    transition: width 0.3s ease;
}

#board {
    margin: 0 auto;
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    grid-template-rows: repeat(6, 1fr);
    gap: 6px;
    /* Responsive sizing: clamp ensures the board remains between 280px and 420px wide */
    /*
      Make the board responsive across orientations.  In portrait mode the width
      expands up to 90vw, while in landscape we cap the width relative to
      viewport height to ensure the board fits the screen.  The aspect ratio is
      preserved by using an intrinsic ratio (aspect-ratio: 1).  We allow the
      height to adjust automatically in landscape to avoid vertical overflow.
    */
    width: clamp(280px, 90vw, 420px);
    aspect-ratio: 1 / 1;
    user-select: none;
    touch-action: none;
    /* Add subtle shadow around the board */
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    background: #ecf0f1;
    padding: 6px;
    border-radius: 12px;
}

/* Landscape orientation adjustments */
@media (orientation: landscape) {
    #board {
        /* In landscape, base the width on the viewport height to ensure the board is fully visible */
        width: clamp(200px, 65vh, 60vw);
        aspect-ratio: 1 / 1;
    }
    #app {
        /* Limit the max width in landscape to avoid excessively wide layouts */
        max-width: 600px;
    }
}

.tile {
    width: 100%;
    height: 100%;
    border-radius: 12px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    transition: transform 0.1s ease, opacity 0.1s ease;
    position: relative;
}

.tile.selected {
    border: 3px solid #ecf0f1;
    opacity: 0.85;
    transform: scale(0.95);
    /* Blue glow effect */
    box-shadow: 0 0 10px 4px rgba(100, 180, 255, 0.75);
}

/* Colour definitions */
.tile.red { background: linear-gradient(#e74c3c, #c0392b); }
.tile.blue { background: linear-gradient(#3498db, #2980b9); }
.tile.yellow { background: linear-gradient(#f1c40f, #d4ac0d); }
.tile.green { background: linear-gradient(#2ecc71, #27ae60); }
.tile.purple { background: linear-gradient(#9b59b6, #8e44ad); }

#controls {
    margin-top: 15px;
}

button {
    padding: 10px 18px;
    margin: 4px;
    font-size: 16px;
    border: none;
    border-radius: 6px;
    background-color: #2980b9;
    color: #fff;
    cursor: pointer;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    transition: background 0.2s ease;
    min-width: 120px;
}

button:hover {
    background-color: #1f6691;
}

button:disabled {
    background-color: #95a5a6;
    cursor: default;
}

#message {
    margin-top: 12px;
    font-size: 18px;
    color: #d35400;
    min-height: 24px;
}

/* Overlay for onboarding and game over */
.overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 100;
}

.overlay.hidden {
    display: none;
}

.modal {
    background: #ffffff;
    border-radius: 12px;
    padding: 24px;
    max-width: 320px;
    width: 90%;
    color: #333;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
    text-align: center;
}

.modal h2 {
    margin-top: 0;
    margin-bottom: 12px;
    font-size: 24px;
}

.modal ul {
    text-align: left;
    margin: 0 0 16px;
    padding-left: 20px;
    line-height: 1.4;
}

.modal button {
    width: 100%;
    margin-top: 8px;
}

/* Cut-in overlay displayed in the center for special events */
.cutin {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(1);
    font-size: 64px;
    font-weight: bold;
    color: #e74c3c;
    opacity: 0;
    pointer-events: none;
    text-shadow: 0 0 10px rgba(255,255,255,0.8);
    z-index: 200;
}

.cutin.show {
    animation: cutin-anim 1.2s forwards;
}

.cutin.hidden {
    display: none;
}

@keyframes cutin-anim {
    0% { opacity: 0; transform: translate(-50%, -50%) scale(0.4); }
    20% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
    80% { opacity: 1; transform: translate(-50%, -50%) scale(1.0); }
    100% { opacity: 0; transform: translate(-50%, -50%) scale(1.2); }
}

/* Animation for falling tiles (jelly bounce) */
@keyframes jelly-drop {
    0% { transform: scale(1.3); }
    50% { transform: scale(0.9); }
    70% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

.tile.fall {
    animation: jelly-drop 0.4s ease;
}

/* Animation for bursting tiles when they disappear */
@keyframes burst {
    0% { transform: scale(1); opacity: 1; }
    80% { transform: scale(1.4); opacity: 0; }
    100% { transform: scale(0); opacity: 0; }
}

.tile.burst {
    animation: burst 0.4s ease forwards;
}